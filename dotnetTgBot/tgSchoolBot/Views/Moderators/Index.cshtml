@model List<User>
@{
    ViewData["Title"] = "Управление модераторами";
    var isAdmin = ViewBag.IsAdmin as bool? ?? false;
    var classInfo = ViewBag.Class as Class;
}

<h2>Управление модераторами</h2>
<div class="mb-3">
    <form method="get" action="/Moderators/Index" class="d-flex align-items-center gap-2">
        <label for="SelectedClassId" class="form-label mb-0">Класс:</label>
        @Html.DropDownList("classId", new SelectList(ViewBag.Classes ?? new List<Class>(), "Id", "Name", ViewBag.SelectedClassId), new { @class = "form-select", onchange = "this.form.submit()" })
        <noscript><button type="submit" class="btn btn-primary btn-sm">Выбрать</button></noscript>
    </form>
</div>

<div class="card mb-3">
    <div class="card-header">
        <h5>Добавить модератора</h5>
    </div>
    <div class="card-body">
        <form method="post" action="/Moderators/AddModerator">
            @Html.AntiForgeryToken()
            <div class="row">
                <div class="col-md-8">
                    <input type="text" class="form-control" name="telegramUserId" placeholder="Telegram User ID" required>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">Добавить модератора</button>
                </div>
            </div>
            <small class="form-text text-muted">Введите Telegram User ID пользователя, которого хотите сделать модератором</small>
        </form>
    </div>
</div>

<h4>Текущие модераторы</h4>

@if (Model != null && Model.Any())
{
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Имя</th>
                    <th>Username</th>
                    <th>Telegram User ID</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var moderator in Model)
                {
                    <tr>
                        <td>@moderator.Id</td>
                        <td>@(moderator.FirstName ?? "Не указано") @(moderator.LastName ?? "")</td>
                        <td>@(moderator.Username ?? "Не указано")</td>
                        <td>@moderator.TelegramUserId</td>
                        <td>
                            @if (isAdmin)
                            {
                                <form method="post" action="/Moderators/RemoveModerator/@moderator.Id" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Удалить права модератора у этого пользователя?')">
                                        Удалить права
                                    </button>
                                </form>
                            }
                            else
                            {
                                <span class="text-muted">Только админ может удалять</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert alert-info">Нет модераторов</div>
}

